<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Lista - Sistema Audiovisual Cloud</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --netflix-red: #E50914;
            --bg-black: #141414;
            --card-gray: #1f1f1f;
            --star-color: #f1c40f;
            --type-green: #2ecc71;
        }

        body {
            background-color: var(--bg-black);
            color: white;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
            padding-top: 230px;
        }

        header {
            background-color: rgba(0,0,0,0.95);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            padding: 20px 4%;
            box-sizing: border-box;
            border-bottom: 1px solid #333;
        }

        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--netflix-red);
            font-size: 1.5rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        nav {
            display: flex;
            gap: 15px;
        }

        .nav-link {
            color: #aaa;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .nav-link.active {
            color: white;
            background: var(--netflix-red);
        }

        .filter-bar {
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            align-items: center;
        }

        .filter-bar input {
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 12px;
            border-radius: 4px;
            outline: none;
            font-size: 1rem;
            flex: 2;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
        }

        #migrationBtn {
            background: #f39c12;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }

        #tmdbUpdateBtn {
            background: #3498db;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-add {
            background: #fff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }

        main {
            padding: 0 4% 50px 4%;
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .movie-card {
            background: var(--card-gray);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            min-height: 380px;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s;
        }

        .movie-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .movie-poster-container {
            width: 100%;
            height: 260px;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 3rem;
        }

        .movie-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .movie-info {
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-grow: 1;
        }

        .movie-title {
            font-weight: bold;
            font-size: 0.95rem;
            margin-top: 5px;
            height: 2.8em;
            overflow: hidden;
        }

        .tag {
            color: var(--type-green);
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .star-rating {
            margin-top: 5px;
            display: flex;
            align-items: center;
        }

        .stars-outer {
            position: relative;
            color: #444;
            font-size: 0.8rem;
        }

        .stars-inner {
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            width: 0;
            color: var(--star-color);
            white-space: nowrap;
        }

        .rating-number {
            font-weight: bold;
            color: var(--star-color);
            margin-left: 8px;
            font-size: 0.8rem;
        }

        .btn-delete {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 5;
        }

        .movie-card:hover .btn-delete {
            opacity: 1;
        }

        #modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #181818;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .modal-content input, .modal-content textarea {
            background: #333;
            border: 1px solid #444;
            color: white;
            padding: 12px;
            border-radius: 4px;
        }
        
        /* BLOQUEIO TEMPORÁRIO DE ADMINISTRAÇÃO */
        #migrationBtn, 
        #tmdbUpdateBtn, 
            .btn-add, 
            .btn-delete {
                display: none !important;
        }

        /* --- AJUSTES PARA DISPOSITIVOS MÓVEIS (Celulares) --- */
@media (max-width: 768px) {
    body {
        padding-top: 180px; /* Reduz o espaço do topo no mobile */
    }

    header {
        padding: 15px 4%;
    }

    .header-main {
        flex-direction: column; /* Título e Nav ficam um em cima do outro */
        gap: 15px;
        margin-bottom: 15px;
    }

    h1 {
        font-size: 1.2rem; /* Título menor */
    }

    nav {
        width: 100%;
        justify-content: space-between; /* Distribui abas igualmente */
    }

    .nav-link {
        font-size: 0.8rem;
        padding: 8px 12px;
        flex: 1;
        text-align: center;
    }

    .filter-bar {
        padding: 10px;
        flex-direction: column; /* Filtros ficam em cascata */
    }

    .filter-bar input, .filter-bar select {
        width: 100%; /* Ocupam a largura toda */
        font-size: 0.9rem;
    }

    .movie-grid {
        grid-template-columns: repeat(2, 1fr); /* 2 colunas por linha no celular */
        gap: 15px;
    }

    .movie-card {
        min-height: 300px; /* Cards menores para caberem dois */
    }

    .movie-poster-container {
        height: 200px; /* Imagem menor */
    }

    .movie-title {
        font-size: 0.85rem;
    }
}

/* Ajuste para telas muito pequenas (iPhone SE, etc) */
@media (max-width: 400px) {
    .movie-grid {
        grid-template-columns: repeat(2, 1fr); /* Mantém 2 colunas, mas diminui o gap */
        gap: 10px;
    }
}
    </style>
    
</head>
<body>

    <header>
        <div class="header-main">
            <h1>MINHA LISTA</h1>
            <nav>
                <div class="nav-link active" onclick="window.switchTab('filmes', this)">Filmes</div>
                <div class="nav-link" onclick="window.switchTab('series', this)">Séries</div>
                <div class="nav-link" onclick="window.switchTab('animacoes', this)">Animações</div>
            </nav>
            <button class="btn-add" onclick="window.openModal()">+ ADICIONAR</button>
        </div>
        <div class="filter-bar">
            <input type="text" id="searchInput" placeholder="Pesquisar título..." oninput="window.applyFilters()">
            <div class="admin-controls">
                <button id="migrationBtn" onclick="window.migrateToFirebase()">MIGRAR TUDO (LISTA NOVA)</button>
                <button id="tmdbUpdateBtn" onclick="window.updateAllPosters()">BUSCAR POSTERS</button>
            </div>
        </div>
    </header>

    <div id="modal">
        <div class="modal-content">
            <h2 style="color: var(--netflix-red); margin: 0;">Nova Obra</h2>
            <input type="text" id="newTitle" placeholder="Título">
            <input type="text" id="newType" placeholder="Tipo (Ex: Ficção)">
            <input type="number" id="newRating" placeholder="Nota" step="0.25">
            <textarea id="newReview" placeholder="Seu relato..."></textarea>
            <div style="display:flex; gap:10px;">
                <button onclick="window.closeModal()" style="flex:1; padding:10px; background:#444; border:none; color:white;">Cancelar</button>
                <button onclick="window.saveEntry()" style="flex:1; padding:10px; background:var(--netflix-red); color:white; font-weight:bold;">Salvar</button>
            </div>
        </div>
    </div>

    <main>
        <p id="stats" style="font-weight: bold; color: #888;">Verificando conexão...</p>
        <div class="movie-grid" id="movie-grid"></div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc, initializeFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- PREENCHA SUAS CHAVES AQUI ---
        const firebaseConfig = {
            apiKey: "AIzaSyD4QIzbdBZB8IUloK6KPlMrBZ83BTYzc9Q",
            authDomain: "listaaudiovisual.firebaseapp.com",
            projectId: "listaaudiovisual",
            storageBucket: "listaaudiovisual.firebasestorage.app",
            messagingSenderId: "790211725412",
            appId: "1:790211725412:web:2b3330d88dc1920ddb7771"
        };

        const TMDB_API_KEY = "d09c3aec764d2a8d3307a3f96517ac15"


        const app = initializeApp(firebaseConfig);
        const db = initializeFirestore(app, { experimentalForceLongPolling: true });

        // --- LISTA DE FILMES CONSOLIDADA ---
        const initialMovies = [
            { title: "007", type: "Ação/Thriller", rating: 4.0 },
                    { title: "300", type: "Ficção/Ação", rating: 4.75 },
                    { title: "300: a ascensão do império", type: "Ficção/Ação", rating: 4.0 },
                    { title: "60 minutos", type: "Ação/Luta", rating: 2.5 },
                    { title: "65: ameaça pré-histórica", type: "Ação/Ficção", rating: 2.5 },
                    { title: "A chegada", type: "Ficção/Suspense", rating: 4.25 },
                    { title: "A Grande Muralha", type: "Ação", rating: 3 },
                    { title: "A guerra do amanhã", type: "Ação/Ficção", rating: 3.5 },
                    { title: "A hora do rush (saga)", type: "Ação/Comédia", rating: 4.5 },
                    { title: "A mulher rei", type: "Ação/Drama", rating: 5.0 },
                    { title: "A múmia (1999, 2001 e 2008)", type: "Ação/Ficção/Thriller", rating: 3.5 },
                    { title: "A múmia (2017)", type: "Ação/Ficção/Thriller", rating: 2.5 },
                    { title: "A onda (die welle)", type: "Thriller", rating: 5.0 },
                    { title: "A origem", type: "Suspense/Thriller", rating: 4.0 },
                    { title: "A presença", type: "Ficção", rating: 1.0 },
                    { title: "A substância", type: "Drama/Ficção", rating: 5.0 },
                    { title: "A vila", type: "Ficção Científica", rating: 3.5 },
                    { title: "Acompanhante Perfeita", type: "Thriller/Ficção", rating: 5.0 },
                    { title: "Adão Negro", type: "Ficção", rating: 3.5 },
                    { title: "Ainda estou aqui", type: "Drama", rating: 5 },
                    { title: "Alerta Vermelho", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Alice (Subservience)", type: "Ficção", rating: 3.0 },
                    { title: "Aliens (todos)", type: "Ficção/Terror", rating: 3.5 },
                    { title: "Amor e Monstros", type: "Ficção/Thriller", rating: 4 },
                    { title: "Amsterdam", type: "Comédia/Mistério", rating: 4.0 },
                    { title: "Anaconda", type: "Comédia", rating: 3.5 },
                    { title: "Animais Fantásticos e Onde Habitam", type: "Ficção/Fantasia", rating: 4.0 },
                    { title: "Anônimo 1 e 2", type: "Ação", rating: 4.5 },
                    { title: "Apertem os cintos, o piloto sumiu", type: "Comédia", rating: 2.5 },
                    { title: "Aquaman (saga)", type: "Ação/Ficção", rating: 4.5 },
                    { title: "Armadilha", type: "Thriller/Crime", rating: 4.0 },
                    { title: "As Marvels", type: "Ficção", rating: 4.0 },
                    { title: "Ash: Planeta parasita", type: "Ficção", rating: 1.0 },
                    { title: "Atlas", type: "Ficção/Ação", rating: 3.5 },
                    { title: "Awareness - a realidade é uma ilusão", type: "Ação/Ficção", rating: 3.0 },
                    { title: "Bad Boys", type: "Ação", rating: 4.0 },
                    { title: "Bagagem de Risco", type: "Ação/Suspense/Thriller", rating: 4.5 },
                    { title: "Ballerina", type: "Ação", rating: 4.25 },
                    { title: "Barbie", type: "Drama/Fantasia", rating: 5.0 },
                    { title: "Batem à porta", type: "Suspense/Ficção", rating: 4.0 },
                    { title: "Batman (2022)", type: "Ação/Thriller/Ficção", rating: 4.0 },
                    { title: "Batman x Super-homem", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Batman: o cavalheiro das trevas (1 e 2)", type: "Ação/Thriller/Ficção", rating: 4.75 },
                    { title: "Beetlejuice 1 e 2", type: "Comédia/Terror", rating: 4.0 },
                    { title: "Besouro azul", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Biônicos", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Bliss em busca da felicidade", type: "Ficção/Romance", rating: 2.5 },
                    { title: "Bohemian Rhapsody", type: "Documentário/Biografia", rating: 5.0 },
                    { title: "Brick", type: "Suspense", rating: 3.0 },
                    { title: "Bright", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Brightburn: filho das trevas", type: "Terror/Ficção", rating: 4.0 },
                    { title: "Caçadores de emoção", type: "Ação/Thriller", rating: 5.0 },
                    { title: "Capitão américa admirável mundo novo", type: "Ação/Ficção", rating: 3.5 },
                    { title: "Carga explosiva (1, 2 e 3)", type: "Ação/Thriller", rating: 3.5 },
                    { title: "Cavaleiros do zodíaco – Saint Seyia: o começo", type: "Ação/Ficção", rating: 2.5 },
                    { title: "Chefes de Estado", type: "Ação/Comédia", rating: 3.5 },
                    { title: "Cidade de Deus", type: "Drama/Crime", rating: 5.0 },
                    { title: "Cidade dos anjos", type: "Drama/Ficção", rating: 5.0 },
                    { title: "Círculo de fogo (saga)", type: "Ficção/Ação", rating: 4.5 },
                    { title: "Clonaram Tyrone", type: "Thriller/Ficção", rating: 4.0 },
                    { title: "Cloverfield: monstro", type: "Suspense/Thriller", rating: 4.0 },
                    { title: "Cloverfield: rua 10", type: "Suspense/Thriller", rating: 5.0 },
                    { title: "Clube da luta para meninas", type: "Comédia", rating: 3.0 },
                    { title: "Code 8: Renegados", type: "Ficção/Thriller", rating: 3.0 },
                    { title: "Código preto (Thriller)", type: "Thriller", rating: 3.5 },
                    { title: "Como estrelas na terra", type: "Drama Biográfico", rating: 5.0 },
                    { title: "Conclave", type: "Thriller/Drama", rating: 5.0 },
                    { title: "Conrack", type: "Drama", rating: 5.0 },
                    { title: "Contra o mundo", type: "Ação/Luta", rating: 3.0 },
                    { title: "Coringa 1", type: "Drama", rating: 5.0 },
                    { title: "Coringa 2", type: "Drama", rating: 1.5 },
                    { title: "Corra!", type: "Terror/Ação", rating: 3.5 },
                    { title: "Cruella", type: "Comédia/Drama", rating: 5.0 },
                    { title: "Deadpool (saga)", type: "Ação/Ficção", rating: 5.0 },
                    { title: "Dentro (Thriller)", type: "Suspense/Thriller", rating: 3.25 },
                    { title: "dIAbólica (Afraid)", type: "Suspense/Ficção Científica", rating: 4.5 },
                    { title: "Diário de motocicleta", type: "Drama Biográfico", rating: 5.0 },
                    { title: "Distrito 9", type: "Ficção/Drama", rating: 5.0 },
                    { title: "Divergente (saga)", type: "Ação/Ficção", rating: 3.0 },
                    { title: "Doom", type: "Ação/Ficção", rating: 3.0 },
                    { title: "Drop: ameaça anônima", type: "Thriller/Suspense", rating: 1.75 },
                    { title: "Duna", type: "Ação/Ficção", rating: 5.0 },
                    { title: "Dungeons & Dragons: a ascensão", type: "Ação/Ficção", rating: 5.0 },
                    { title: "Dupla Jornada", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Duro de atuar", type: "Comédia", rating: 4.5 },
                    { title: "Duro de matar", type: "Ação", rating: 4.5 },
                    { title: "É o fim", type: "Comédia/Ficção", rating: 4.0 },
                    { title: "Enola Holmes", type: "Ficção/Thriller", rating: 4.0 },
                    { title: "Ensaio sobre a cegueira", type: "Suspense/Drama", rating: 4.75 },
                    { title: "Entre facas e segredos (1, 2 e 3)", type: "Thriller", rating: 5.0 },
                    { title: "Entre montanhas", type: "Ficção/Ação", rating: 3.5 },
                    { title: "Entrevista com o demônio", type: "Terror/Ficção", rating: 3.0 },
                    { title: "Entrevista com vampiro", type: "Terror/Fantasia", rating: 3.0 },
                    { title: "Equilibrium", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Era um vez em hollywood", type: "Drama/Comédia/Thriller", rating: 3.5 },
                    { title: "Esquadrão suicida", type: "Ficção", rating: 4.0 },
                    { title: "Estrelas além do tempo", type: "Drama Biográfico", rating: 5.0 },
                    { title: "Eternos", type: "Ficção/Ação", rating: 2.0 },
                    { title: "Eu sou a lenda", type: "Ficção/Drama", rating: 4.0 },
                    { title: "Eu, Daniel Blake", type: "Drama", rating: 5.0 },
                    { title: "Ex Machina", type: "Ficção/Drama", rating: 3.5 },
                    { title: "Extermínio (saga)", type: "Ficção/Suspense/Thriller", rating: 4.25 },
                    { title: "Filadélfia", type: "Drama", rating: 5.0 },
                    { title: "Five Nights at Freddys", type: "Terror/Comédia", rating: 2.0 },
                    { title: "Fratura", type: "Thriller/Mistério", rating: 3.0 },
                    { title: "Freaks - um de nós", type: "Ação/Ficção", rating: 2.0 },
                    { title: "Free Guy", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Fúria de Titãs 1 e 2", type: "Ficção/Ação", rating: 4.0 },
                    { title: "Furiosa: uma saga Mad Max", type: "Thriller/Ação", rating: 4.5 },
                    { title: "G.I joe (saga)", type: "Ação/Ficção", rating: 4.0 },
                    { title: "GATTACA", type: "Ficção/Drama", rating: 5.0 },
                    { title: "Gladiador 1", type: "Ação/Drama", rating: 4.75 },
                    { title: "Gladiador 2", type: "Ação/Drama", rating: 4.0 },
                    { title: "Godzilla (saga)", type: "Ficção/Ação", rating: 4.0 },
                    { title: "Godzilla Minus One", type: "Drama/Ficção", rating: 5.0 },
                    { title: "Godzilla x Kong + Godzilla e Kong", type: "Ficção/Ação", rating: 4.0 },
                    { title: "Gran Turismo", type: "Esporte/Ação", rating: 3.0 },
                    { title: "Guardiões da Galáxia vol. 1, 2 e 3", type: "Ficção/Ação", rating: 5.0 },
                    { title: "Guerra do amanhã", type: "Ação/Ficção", rating: 3.5 },
                    { title: "Guerra Mundial Z", type: "Ficção/Thriller", rating: 3.5 },
                    { title: "Guerra sem regras", type: "Ação", rating: 3.5 },
                    { title: "Harold e o Lápis Mágico", type: "Fantasia", rating: 3.5 },
                    { title: "Hellboy e o homem torto", type: "Ficção/Ação", rating: 1.0 },
                    { title: "Homem-aranha (Saga Sony)", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Homem-aranha (Saga UCM)", type: "Ação/Ficção", rating: 5.0 },
                    { title: "Homem-formiga (saga)", type: "Ação/Ficção", rating: 3.0 },
                    { title: "I am mother", type: "Ficção/Drama", rating: 4.0 },
                    { title: "Independence Day 1", type: "Ficção/Thriller", rating: 5.0 },
                    { title: "Independence Day 2", type: "Ficção/Thriller", rating: 4.0 },
                    { title: "Infiltrados na Klan", type: "Thriller/Drama", rating: 4.75 },
                    { title: "Interestelar", type: "Ficção/Drama", rating: 4.5 },
                    { title: "Irmãos", type: "Comédia/Crime", rating: 3.0 },
                    { title: "Jogador número 1", type: "Ficção/Ação", rating: 4.0 },
                    { title: "Jogos vorazes (saga)", type: "Ficção/Ação", rating: 5.0 },
                    { title: "John Wick (saga)", type: "Ação/Thriller", rating: 5.0 },
                    { title: "Jolt: Fúria fatal", type: "Ação/Comédia", rating: 3.0 },
                    { title: "Jumanji (1995)", type: "Ficção/Thriller/Comédia", rating: 4.0 },
                    { title: "Jumanji (2016 e 2019)", type: "Ficção/Thriller/Comédia", rating: 3.5 },
                    { title: "Jungle Cruise", type: "Aventura/Fantasia", rating: 3.0 },
                    { title: "Jurado n°2", type: "Thriller/Drama", rating: 3.5 },
                    { title: "Karate Kid: Lendas", type: "Drama/Thriller", rating: 4.0 },
                    { title: "Kill Bill (saga)", type: "Thriller/Ação", rating: 4.25 },
                    { title: "King's man (saga)", type: "Ação/Ficção", rating: 4.5 },
                    { title: "Ladrões", type: "Ação/Drama", rating: 4.5 },
                    { title: "Ligação sombria", type: "Suspense/Thriller", rating: 3.0 },
                    { title: "Liga da Justiça", type: "Ficção", rating: 3.75 },
                    { title: "Linha de extinção", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Loteria Fatal", type: "Comédia/Ação", rating: 3.0 },
                    { title: "Lucy", type: "Ficção/Thriller", rating: 2.5 },
                    { title: "M3GAN (1 e 2)", type: "Ficção/Ação", rating: 4.5 },
                    { title: "Madame Teia", type: "Ação/Ficção", rating: 1.0 },
                    { title: "Madmax (todos)", type: "Ficção/Thriller/Ação", rating: 4.5 },
                    { title: "Massa cinzenta", type: "Ficção/Thriller", rating: 2.5 },
                    { title: "Matrix", type: "Ficção/Ação", rating: 5.0 },
                    { title: "Max Steel", type: "Ação/Ficção", rating: 2.5 },
                    { title: "Maze runner (saga)", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Megalópolis", type: "Ficção/Drama", rating: 1.0 },
                    { title: "MIB: Homens de Preto (1,2 e 3)", type: "Ficção/Comédia", rating: 4.25 },
                    { title: "MIB: Homens de Preto Internacional", type: "Ficção/Comédia", rating: 3.25 },
                    { title: "Mickey 17", type: "Thriller/Ficção", rating: 4.25 },
                    { title: "Missão impossível (saga)", type: "Ação/Thriller", rating: 5.0 },
                    { title: "Moonfall", type: "Drama/Ficção", rating: 3.0 },
                    { title: "Mortal Kombat", type: "Ação/Ficção", rating: 3.0 },
                    { title: "Mr. Holland: adorável professor", type: "Drama/Musical", rating: 4.0 },
                    { title: "Ms. Marvel", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Mundo em caos", type: "Ficção/Thriller", rating: 3.5 },
                    { title: "Não, não olhe!", type: "Ficção/Suspense", rating: 4.0 },
                    { title: "Não olhe para cima", type: "Ficção/Drama", rating: 4.5 },
                    { title: "Não se mexa", type: "Terror/Thriller", rating: 3.0 },
                    { title: "Não solte nunca", type: "Suspense/Thriller", rating: 3.0 },
                    { title: "Need for Speed", type: "Ação", rating: 3.0 },
                    { title: "No limite do amanhã", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Nosso Amigo Extraordinário", type: "Comédia/Drama", rating: 3.5 },
                    { title: "Novocaína", type: "Ação/Comédia", rating: 4.0 },
                    { title: "O agente secreto", type: "Thriller", rating: 4.5 },
                    { title: "O astronauta", type: "Ficção/Drama", rating: 3.0 },
                    { title: "O código Da Vinci", type: "Ficção/Thriller", rating: 4.5 },
                    { title: "O Contador 1 e 2", type: "Ação", rating: 3.5 },
                    { title: "O Despertar de uma paixão", type: "Drama", rating: 3.5 },
                    { title: "O destino de Jupiter", type: "Ficção/Thriller", rating: 3.0 },
                    { title: "O diabo de cada dia", type: "Drama", rating: 4.25 },
                    { title: "O doador de memórias", type: "Ficção/Thriller", rating: 5.0 },
                    { title: "O dublê", type: "Ação", rating: 3.0 },
                    { title: "O esquadrão suicida", type: "Ficção", rating: 4.0 },
                    { title: "O exterminador do futuro (saga)", type: "Ficção/Thriller", rating: 3.0 },
                    { title: "O homem do Norte", type: "Ação/Drama", rating: 4.25 },
                    { title: "O homem invisível", type: "Terror/Ficção", rating: 3.5 },
                    { title: "O máscara", type: "Comédia", rating: 5.0 },
                    { title: "O mundo depois de nós", type: "Ficção/Terror", rating: 3.5 },
                    { title: "O poço 1 e 2", type: "Terror/Thriller", rating: 4.0 },
                    { title: "O predador: a caçada", type: "Ficção/Suspense", rating: 4.0 },
                    { title: "O predestinado", type: "Ficção/Thriller", rating: 3.5 },
                    { title: "O protetor 1 e 2", type: "Ação", rating: 4.0 },
                    { title: "O regresso", type: "Thriller/Drama", rating: 4.5 },
                    { title: "O senhor das arma", type: "Thriller", rating: 3.5 },
                    { title: "O senhor das armas", type: "Thriller", rating: 3.5 },
                    { title: "O Senhor dos Anéis – Trilogia", type: "Ficção/Ação", rating: 5.0 },
                    { title: "O sobrevivente", type: "Ação/Thriller", rating: 4.5 },
                    { title: "O telefone preto 1 e 2", type: "Terror", rating: 4.5 },
                    { title: "O Último Mestre do Ar", type: "Aventura/Ficção", rating: 3.5 },
                    { title: "Onde está segunda?", type: "Ficção/Thriller", rating: 4.5 },
                    { title: "Onze homens e um segredo", type: "Thriller", rating: 4.5 },
                    { title: "Operação Natal", type: "Ação/Ficção", rating: 2.5 },
                    { title: "Operação Vingança", type: "Thriller", rating: 4.25 },
                    { title: "Oppenheimer", type: "Ficção/Drama", rating: 5.0 },
                    { title: "Palm Springs", type: "Ficção/Drama", rating: 3.5 },
                    { title: "Parasita", type: "Drama/Thriller", rating: 5.0 },
                    { title: "Pecadores", type: "Thriller/Ficção", rating: 5.0 },
                    { title: "Pisque duas vezes", type: "Suspense/Drama", rating: 4.0 },
                    { title: "Pixels", type: "Fantasia/Aventura", rating: 5.0 },
                    { title: "Planeta dos macacos (saga)", type: "Ficção/Ação", rating: 4.0 },
                    { title: "Pobres Criaturas", type: "Drama/Ficção", rating: 5.0 },
                    { title: "Polar", type: "Ação", rating: 3.0 },
                    { title: "Ponto vermelho", type: "Suspense/Thriller", rating: 4.0 },
                    { title: "Predestinado", type: "Ficção", rating: 3.5 },
                    { title: "Premonição 6", type: "Suspense/Terror", rating: 4.5 },
                    { title: "Projeto Adam", type: "Ação/Ficção", rating: 3.0 },
                    { title: "Projeto Almanaque", type: "Ficção/Aventura", rating: 3.0 },
                    { title: "Projeto Ithaca", type: "Ficção/Suspense", rating: 1.5 },
                    { title: "Próxima parada: apocalipse", type: "Thriller/Suspense", rating: 1.0 },
                    { title: "Psicopata americano", type: "Terror/Thriller", rating: 4.0 },
                    { title: "Rampage", type: "Ficção/Thriller", rating: 3.0 },
                    { title: "Rebel Moon (Saga)", type: "Ficção/Ação", rating: 3.0 },
                    { title: "Renfield", type: "Terror/Comédia", rating: 4.0 },
                    { title: "Resgate implacável", type: "Ação", rating: 2.0 },
                    { title: "Resistência", type: "Ficção/Thriller", rating: 4.0 },
                    { title: "Rick Stanicky", type: "Comédia", rating: 5.0 },
                    { title: "Riddick (saga)", type: "Ação/Ficção", rating: 2.5 },
                    { title: "Ruby Sparks", type: "Romance/Fantasia", rating: 4.0 },
                    { title: "Saltburn", type: "Thriller/Comédia", rating: 4.25 },
                    { title: "Scott Pilgrim", type: "Comédia/Thriller", rating: 4.5 },
                    { title: "Se beber, não case", type: "Comédia", rating: 4.75 },
                    { title: "Sementes podres", type: "Comédia/Drama", rating: 5.0 },
                    { title: "Sempre em frente", type: "Drama", rating: 4.0 },
                    { title: "Sete homens e um destino", type: "Thriller/Ação", rating: 3.0 },
                    { title: "Shaft", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Shang-Chi", type: "Ficção/Ação", rating: 5.0 },
                    { title: "Shazam!", type: "Ficção/Ação", rating: 3.0 },
                    { title: "Sherlock holmes", type: "Ficção/Thriller", rating: 5.0 },
                    { title: "Shrek (saga)", type: "Fantasia/Aventura", rating: 5.0 },
                    { title: "Sonic (saga)", type: "Fantasia/Aventura", rating: 5.0 },
                    { title: "Stargate", type: "Ficção/Thriller", rating: 4.0 },
                    { title: "Superman", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Take Me", type: "Comédia", rating: 5.0 },
                    { title: "Tartarugas ninjas", type: "Aventura/Fantasia", rating: 5.0 },
                    { title: "Tenet", type: "Ficção/Ação", rating: 2.0 },
                    { title: "Terra à deriva", type: "Ficção/Ação", rating: 3.5 },
                    { title: "The Batman", type: "Ação/Ficção", rating: 4.0 },
                    { title: "The Electric State", type: "Thriller/Ficção", rating: 3.0 },
                    { title: "The Flash", type: "Ação/Ficção", rating: 3.0 },
                    { title: "The Perfection", type: "Drama/Terror", rating: 3.0 },
                    { title: "These final hours", type: "Drama/Thriller", rating: 4.5 },
                    { title: "Thor (saga)", type: "Ação/Ficção", rating: 3.5 },
                    { title: "Thunderbolts", type: "Ficção/Ação", rating: 4.8 },
                    { title: "TOC TOC", type: "Comédia", rating: 5.0 },
                    { title: "Transformers", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Trem-bala", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Trocados", type: "Comédia/Fantasia", rating: 3.0 },
                    { title: "Tróia", type: "Ação/Thriller", rating: 4.0 },
                    { title: "Tropa de elite (1 e 2)", type: "Ação", rating: 4.5 },
                    { title: "Truque de mestre (1, 2 e 3)", type: "Thriller", rating: 4.5 },
                    { title: "Tudo em todo lugar ao mesmo tempo", type: "Ficção/Thriller", rating: 4.0 },
                    { title: "Um contratempo", type: "Suspense/Thriller", rating: 4.5 },
                    { title: "Um dia fora do controle", type: "Comédia/Ação", rating: 3.75 },
                    { title: "Um golpe do destino", type: "Drama", rating: 4.5 },
                    { title: "Um príncipe em nova york", type: "Comédia", rating: 4.25 },
                    { title: "Uma noite de crimes", type: "Terror/Suspense", rating: 4.0 },
                    { title: "Uncharted", type: "Ação/Aventura", rating: 3.0 },
                    { title: "V de Vingança", type: "Ação/Ficção", rating: 5.0 },
                    { title: "Valerian e a cidade dos mil planetas", type: "Ficção/Thriller", rating: 2.25 },
                    { title: "Velocipastor", type: "Terror/Comédia", rating: 1.0 },
                    { title: "Viagem de risco", type: "Ação/Thriller", rating: 3.5 },
                    { title: "Viúva Negra", type: "Ação/Ficção", rating: 4.0 },
                    { title: "Wicked", type: "Ficção/Fantasia", rating: 3.5 },
                    { title: "Wit - uma lição de vida", type: "Drama", rating: 5.0 },
                    { title: "Zona de Combate", type: "Ficção/Ação", rating: 3.5 }
        ];

        const initialSeries = [
            { title: "3%", type: "Ficção", rating: 4.0 },
            { title: "A casa dragão", type: "Ficção/Drama", rating: 5.0 },
            { title: "Agatha desde sempre", type: "Ficção/Fantasia", rating: 3.5 },
            { title: "Ahsoka", type: "Ficção", rating: 4.0 },
            { title: "Alice in Borderland", type: "Ficção/Thriller", rating: 5.0 },
            { title: "Altered Carbon", type: "Ficção Científica", rating: 3.5 },
            { title: "Arrow", type: "Ficção/Ação", rating: 4.0 },
            { title: "Avenue 5", type: "Comédia/Ficção", rating: 3.0 },
            { title: "Black lightning", type: "Ficção/Ação", rating: 3.5 },
            { title: "Breaking Bad", type: "Drama", rating: 5.0 },
            { title: "Cavaleiro da lua", type: "Ficção", rating: 4.0 },
            { title: "Citadel", type: "Ação/Thriller", rating: 4.4 },
            { title: "Cobra Kai", type: "Ação/Comédia/Drama", rating: 5.0 },
            { title: "Criando Dion", type: "Ficção", rating: 5.0 },
            { title: "Dark", type: "Ficção", rating: 5.0 },
            { title: "Dark Matter", type: "Ficção Científica", rating: 3.5 },
            { title: "Dia Zero", type: "Thriller", rating: 4.5 },
            { title: "Doom Patrol", type: "Ficção", rating: 3.5 },
            { title: "Duna: profecia", type: "Ficção/Drama", rating: 5.0 },
            { title: "Echo", type: "Ação/Ficção", rating: 3.5 },
            { title: "Eu sou Groot", type: "Ficção", rating: 3.0 },
            { title: "Falcão e o Soldado Invernal", type: "Ficção", rating: 3.5 },
            { title: "Flash", type: "Ficção", rating: 2.0 },
            { title: "Fringe", type: "Ficção", rating: 4.0 },
            { title: "Fundação", type: "Ficção", rating: 4.25 },
            { title: "Game of Thrones", type: "Drama/Ação", rating: 4.25 },
            { title: "Gavião arqueiro", type: "Ficção", rating: 4.0 },
            { title: "Gen V", type: "Ficção", rating: 5.0 },
            { title: "Gotham", type: "Ficção", rating: 4.25 },
            { title: "Halo", type: "Ficção", rating: 4.5 },
            { title: "Heroes", type: "Ficção", rating: 3.75 },
            { title: "His Dark Materials", type: "Ficção", rating: 2.0 },
            { title: "Iluminadas", type: "Ficção", rating: 4.0 },
            { title: "Inumanos", type: "Ficção", rating: 1.5 },
            { title: "Invasão Secreta", type: "Ficção", rating: 4.25 },
            { title: "Invasion", type: "Ficção", rating: 4.5 },
            { title: "Irmandade", type: "Drama/Criminal", rating: 4.0 },
            { title: "Kenobi", type: "Ficção", rating: 5.0 },
            { title: "La casa de papel", type: "Drama/Criminal", rating: 5.0 },
            { title: "Legacies", type: "Ficção", rating: 3.0 },
            { title: "Legião", type: "Ficção", rating: 4.5 },
            { title: "Lendas do amanhã", type: "Ficção", rating: 2.75 },
            { title: "Loki", type: "Ficção", rating: 5.0 },
            { title: "Love, Death and Robots", type: "Ficção", rating: 4.5 },
            { title: "LoveCraft Country", type: "Ficção/Drama", rating: 4.5 },
            { title: "Lucifer", type: "Ficção", rating: 5.0 },
            { title: "MacGyver", type: "Ação", rating: 3.0 },
            { title: "Manifest – Voo 828", type: "Ficção", rating: 2.5 },
            { title: "Máquina mortífera", type: "Ação/Policial", rating: 3.5 },
            { title: "Merli", type: "Drama", rating: 5.0 },
            { title: "Monarchy: Legacy of Monsters", type: "Ficção/Thriller", rating: 5.0 },
            { title: "O continental", type: "Ação/Thriller", rating: 5.0 },
            { title: "O doutrinador", type: "Ação/Drama", rating: 3.5 },
            { title: "O problema dos 3 corpos", type: "Ficção", rating: 5.0 },
            { title: "O recruta", type: "Thriller", rating: 4.4 },
            { title: "Origem (From)", type: "Terror/Suspense", rating: 5.0 },
            { title: "Ozark", type: "Drama/Criminal", rating: 5.0 },
            { title: "Perdidos no espaço", type: "Ficção", rating: 4.5 },
            { title: "Pinguim", type: "Ficção/Drama", rating: 4.25 },
            { title: "Preacher", type: "Ficção/Comédia", rating: 5.0 },
            { title: "Prison Break", type: "Thriller/Criminal", rating: 4.75 },
            { title: "Ragnarok", type: "Ficção", rating: 3.0 },
            { title: "Ray Donovan", type: "Drama/Thriller/Crime", rating: 5.0 },
            { title: "Reacher", type: "Ação/Thriller", rating: 4.75 },
            { title: "Resident Alien", type: "Comédia/Ficção", rating: 4.75 },
            { title: "Revenge", type: "Drama", rating: 4.5 },
            { title: "Round 6", type: "Drama/Terror", rating: 5.0 },
            { title: "Ruptura", type: "Ficção/Suspense", rating: 4.75 },
            { title: "See", type: "Drama/Ação", rating: 4.75 },
            { title: "She-Hulk", type: "Ficção/Ação", rating: 3.0 },
            { title: "Sherlock", type: "Thriller/Comédia", rating: 4.0 },
            { title: "Silo", type: "Ficção", rating: 5.0 },
            { title: "Star Wars – Andor", type: "Ficção/Ação", rating: 3.75 },
            { title: "Star Wars: The Mandalorian", type: "Ficção/Ação", rating: 4.5 },
            { title: "Stranger Things", type: "Ficção/Terror", rating: 5.0 },
            { title: "Supacell", type: "Ficção/Drama", rating: 4.0 },
            { title: "Supergirl", type: "Ficção", rating: 2.5 },
            { title: "Sweet Tooth", type: "Ficção", rating: 2.0 },
            { title: "The 100", type: "Ficção/Drama", rating: 4.0 },
            { title: "The Boys", type: "Ficção/Thriller", rating: 5.0 },
            { title: "The end of the fucking world", type: "Drama/Comédia/Crime", rating: 4.5 },
            { title: "The Expanse", type: "Ficção", rating: 4.5 },
            { title: "The handmaid’s Tale", type: "Ficção/Drama", rating: 5.0 },
            { title: "The Last of Us", type: "Ficção", rating: 5.0 },
            { title: "The Mandalorian", type: "Ação/Ficção", rating: 5.0 },
            { title: "The outsider", type: "Ficção/Thriller", rating: 4.75 },
            { title: "The Rain", type: "Ficção/Drama", rating: 3.0 },
            { title: "The Umbrella Academy", type: "Ficção", rating: 3.0 },
            { title: "The Witcher", type: "Ficção", rating: 4.0 },
            { title: "Titans", type: "Ficção/Ação", rating: 3.5 },
            { title: "Twisted Metal", type: "Ação/Comédia", rating: 4.5 },
            { title: "Vikings (saga)", type: "Ação", rating: 5.0 },
            { title: "WandaVision", type: "Ficção", rating: 4.5 },
            { title: "Warrior Nun", type: "Ação/Thriller", rating: 3.5 },
            { title: "Westworld", type: "Ficção/Drama", rating: 4.5 },
            { title: "Years and Years", type: "Thriller/Drama", rating: 4.75 }
        ];

        // --- LISTA DE ANIMAÇÕES ---
        const initialAnimations = [
            { title: "Invencível", type: "Ação", rating: 5.0 },
            { title: "O gato de botas 2", type: "Aventura", rating: 5.0 },
            { title: "Procurando Nemo", type: "Aventura", rating: 5.0 },
            { title: "Soul", type: "Drama", rating: 5.0 },
            { title: "Super Mario Bros", type: "Comédia", rating: 5.0 },
            { title: "X-men 97", type: "Ação/Ficção", rating: 5.0 }
        ];

        let dataStore = { filmes: [], series: [], animacoes: [] };
        let currentTab = 'filmes';

        // --- MOTOR TMDB ---
        async function getPoster(title, type) {
            const cat = (type === 'series') ? 'tv' : 'movie';
            const clean = title.split('(')[0].split('–')[0].trim();
            try {
                const r = await fetch(`https://api.themoviedb.org/3/search/${cat}?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(clean)}&language=pt-BR`);
                const d = await r.json();
                return d.results && d.results[0] ? `https://image.tmdb.org/t/p/w500${d.results[0].poster_path}` : "";
            } catch (err) {
                console.error("Erro na busca do poster:", err);
                return "";
            }
        }

        // --- FUNÇÕES DE INTERFACE ---
        window.openModal = () => document.getElementById('modal').style.display = 'flex';
        window.closeModal = () => document.getElementById('modal').style.display = 'none';

        window.fetchFromFirebase = async () => {
            try {
                const s = await getDocs(collection(db, currentTab));
                const l = [];
                s.forEach(d => l.push({ fireId: d.id, ...d.data() }));
                dataStore[currentTab] = l;
                
                // Botão de migração aparece se houver poucos itens (ex: banco zerado)
                document.getElementById('migrationBtn').style.display = (l.length < 5) ? 'inline-block' : 'none';
                renderData();
            } catch (e) {
                console.error(e);
                document.getElementById('stats').innerText = "Erro ao conectar. Verifique as chaves e as regras do Firebase.";
            }
        };

        function renderData(filterData = null) {
            const sorted = [...dataStore[currentTab]].sort((a,b) => a.title.localeCompare(b.title));
            const d = filterData || sorted;
            const g = document.getElementById('movie-grid');
            g.innerHTML = '';
            document.getElementById('stats').innerText = `${currentTab.toUpperCase()} (${d.length} obras)`;
            
            d.forEach(item => {
                const p = (item.rating/5)*100;
                g.innerHTML += `
                <div class="movie-card">
                    <button class="btn-delete" onclick="window.deleteItem('${item.fireId}')"><i class="fas fa-trash"></i></button>
                    <div class="movie-poster-container">
                        ${item.imageUrl ? `<img src="${item.imageUrl}" class="movie-poster">` : `<i class="fas fa-film"></i>`}
                    </div>
                    <div class="movie-info">
                        <div>
                            <div class="tag">${item.type}</div>
                            <div class="movie-title">${item.title}</div>
                            <div class="star-rating">
                                <div class="stars-outer">★★★★★<div class="stars-inner" style="width:${p}%">★★★★★</div></div>
                                <span class="rating-number">${item.rating}</span>
                            </div>
                        </div>
                    </div>
                </div>`;
            });
        }

        window.migrateToFirebase = async () => {
            if(!confirm("Deseja enviar TODAS as listas iniciais (incluindo a nova lista de filmes) para a nuvem?")) return;
            document.getElementById('stats').innerText = "Iniciando migração em massa...";
            try {
                const lists = { 'filmes': initialMovies, 'series': initialSeries, 'animacoes': initialAnimations };
                for (let tab in lists) {
                    document.getElementById('stats').innerText = `Migrando ${tab}...`;
                    for (let item of lists[tab]) {
                        await addDoc(collection(db, tab), { ...item, imageUrl: "", review: "" });
                    }
                }
                alert("Migração concluída com sucesso!");
                location.reload();
            } catch (e) {
                alert("Erro na migração: " + e.message);
            }
        };

        window.updateAllPosters = async () => {
            const s = await getDocs(collection(db, currentTab));
            let i = 0;
            for (let dSnap of s.docs) {
                i++;
                const item = dSnap.data();
                if (!item.imageUrl) {
                    document.getElementById('stats').innerText = `Buscando poster: ${i}/${s.size}`;
                    const img = await getPoster(item.title, currentTab);
                    if (img) await updateDoc(doc(db, currentTab, dSnap.id), { imageUrl: img });
                    await new Promise(r => setTimeout(r, 250));
                }
            }
            alert("Processo de atualização finalizado!");
            location.reload();
        };

        window.saveEntry = async () => {
            const title = document.getElementById('newTitle').value;
            const type = document.getElementById('newType').value;
            const rating = parseFloat(document.getElementById('newRating').value);
            const review = document.getElementById('newReview').value;
            
            if(title && type && !isNaN(rating)) {
                document.getElementById('stats').innerText = "Salvando nova obra...";
                try {
                    const img = await getPoster(title, currentTab);
                    await addDoc(collection(db, currentTab), { title, type, rating, imageUrl: img, review });
                    window.closeModal();
                    await fetchFromFirebase();
                } catch (e) {
                    alert("Erro ao salvar: " + e.message);
                }
            }
        };

        window.switchTab = async (t, e) => {
            currentTab = t;
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            e.classList.add('active');
            await fetchFromFirebase();
        };

        window.deleteItem = async (id) => {
            if(confirm("Deseja excluir esta obra permanentemente da nuvem?")) {
                await deleteDoc(doc(db, currentTab, id));
                await fetchFromFirebase();
            }
        };

        window.applyFilters = () => {
            const t = document.getElementById('searchInput').value.toLowerCase();
            const filtered = dataStore[currentTab].filter(i => i.title.toLowerCase().includes(t));
            renderData(filtered);
        };

        // Início automático
        fetchFromFirebase();
    </script>
</body>
</html>
